<.layout
  current_user={@current_user}
  current_page={:dev_email_templates}
  current_section={:dev}
  padded={false}
>
  <.tabbed_layout current_page={@email_name} menu_items={@email_options}>
    <div class="flex flex-col bg-slate-50 dark:bg-slate-900">
      <main class="relative z-0 flex-1 overflow-y-auto focus:outline-none">
        <div class="p-6">
          <%= if Application.fetch_env!(:passwordless, Passwordless.Mailer) |> Keyword.get(:adapter) ==
                   Swoosh.Adapters.Local do %>
            <.alert color="warning" class="mb-6" with_icon>
              Can't send test emails while Swoosh adapter is Swoosh.Adapters.Local. See dev.exs
            </.alert>
          <% else %>
            <%= if Util.email_valid?(@current_user.email) do %>
              <%= PhoenixHTMLHelpers.Form.form_for :test_email, ~p"/dev/emails/send_test_email/#{@email_name}", fn _f -> %>
                <div class="text-right">
                  <.button label={"Send to #{@current_user.email}"} size="sm" />
                </div>
              <% end %>
            <% else %>
              <.alert color="warning" class="mb-6" with_icon>
                Can't send test email to {@current_user.email} . Please ensure it is a legit email.
              </.alert>
            <% end %>
          <% end %>

          <.page_header title={@email_name} />

          <div class="flex justify-between">
            <div class="text-sm dark:text-slate-100">
              <div>
                From:
                <strong>
                  {@email.from |> elem(0)} &lt;{@email.from |> elem(1)}&gt;
                </strong>
              </div>
              <div>
                Subject:
                <strong>
                  {@email.subject}
                </strong>
              </div>
              <div>Preview text: {@email.private[:preview_text]}</div>
            </div>
          </div>

          <div class="mt-10">
            <.page_header title="Desktop view" />
            <iframe
              style="width: 100%; height: 800px; border: 2px solid #bfbfbf;"
              src={@iframe_url}
            >
            </iframe>
          </div>
          <div class="mt-10">
            <.page_header title="Mobile view" />
            <iframe
              style="width: 360px; height: 400px; border: 2px solid #bfbfbf;"
              src={@iframe_url}
            >
            </iframe>
          </div>
          <div class="mt-10">
            <.page_header title="Plain text" />
            <div class="p-5 whitespace-pre-line bg-white border-2 border-[#bfbfbf]">
              {@email.text_body}
            </div>
          </div>
        </div>
      </main>
    </div>
  </.tabbed_layout>
</.layout>
